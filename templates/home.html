<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–º–∞—à–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</title>
    <link rel="stylesheet" href="/static/css/home.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="block_up">
            <div class="header-user">
                <img id="sidebarAvatar"
                     src="{{ user.avatar_url | default('/static/default-avatar.png') }}?v={{ '%08x' % range(1,999999999)|random }}"
                     class="avatar"
                     alt="–ê–≤–∞—Ç–∞—Ä">
                <span class="nickname">{{ user.username }}</span>
            </div>
            <div class="tab-header-container">
                <div class="tab-header active" data-tab="home" onclick="showTab('home')"><span>–ì–ª–∞–≤–Ω–∞—è</span></div>
                <div class="tab-header" data-tab="profile" onclick="showTab('profile')"><span>–ü—Ä–æ—Ñ–∏–ª—å</span></div>
                <div class="tab-header" data-tab="myBooks" onclick="showTab('myBooks')"><span>–ú–æ–∏ –∫–Ω–∏–≥–∏</span></div>
                {% if session['user_role'] == 2 %}
                <div class="tab-header" data-tab="librarian" onclick="showTab('librarian')"><span>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—å</span></div>
                {% endif %}
                {% if session['user_role'] == 3 %}
                <div class="tab-header" data-tab="admin" onclick="showTab('admin')"><span>–ê–¥–º–∏–Ω</span></div>
                {% endif %}
            </div>
            </div>
            <div class="sidebar-content">
                <h4>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —á–∏—Ç–∞—Ç—å</h4>
                {% if last_reading_book %}
                <div class="book">
                    <div class="book-cover">
                        <img src="{{ last_reading_book.cover_image_url }}" alt="–û–±–ª–æ–∂–∫–∞ –∫–Ω–∏–≥–∏">
                    </div>
                    <div class="block_down">
                    <div class="book-info">
                        <div class="title">{{ last_reading_book.title }}</div>
                        <div class="author">{{ last_reading_book.author_name }}</div>
                        <div class="rating">
                            {% for i in range(last_reading_book.rating|int) %}
                            <span class="star">‚òÖ</span>
                            {% endfor %}
                            <span class="numeric-rating">
                                {% if last_reading_book.rating is not none %}
                                    {{ "%.1f"|format(last_reading_book.rating) }}
                                {% else %}
                                    N/A
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    <button onclick="handleReadButtonClick('{{ last_reading_book.isbn }}', '{{ last_reading_book.file_path }}')" class="read-button">
                        –ß–∏—Ç–∞—Ç—å
                    </button>
                    </div>
                </div>
                {% else %}
                <p>–í—ã –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª–∏ –Ω–∏ –æ–¥–Ω–æ–π –∫–Ω–∏–≥–∏.</p>
                {% endif %}
            </div>
        </div>
        <div class="content">
            <!-- –í–∫–ª–∞–¥–∫–∞ –ì–ª–∞–≤–Ω–∞—è -->
            <div id="home" class="tab">
                <div class="genre-container">
                    {% for genre in genres %}
                    <div class="genre" onclick="showGenre('{{ genre }}')">{{ genre }}</div>
                    {% endfor %}
                    <button id="cancelGener" class="hidden" title="–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã" onclick="clearGenre()">‚úï</button>
                </div>
                <div class="book-shelf" id="genre-results-shelf" style="display:none">
                    <h3></h3>
                    <div class="shelf" id="genre-results-container"></div>
                </div>

                <div class="search-container">
                    <input type="text" placeholder="–ü–æ–∏—Å–∫ –∫–Ω–∏–≥..." id="searchInput">
                    <button onclick="searchBooks()">üîç</button>
                    <button id="cancelSearch" class="hidden" title="–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫">‚úï</button>
                </div>
                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
                <div class="book-shelf" id="search-results-shelf" style="display:none">
                    <h3>üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h3>
                    <div class="shelf" id="search-results-container"></div>
                </div>

                <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–Ω–∏–≥–∏ -->
                <div class="book-shelf">
                    <h3>–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</h3>
                    <div class="shelf">
                        {% for book in popular_books %}
                        <div class="book-item" onclick="window.location.href='{{ url_for('book_detail', isbn=book.isbn) }}'">
                            <img src="{{ book.cover_image_url }}" alt="{{ book.title }}">
                            <div class="book-info">
                                <div class="title">{{ book.title }}</div>
                                <div class="author">{{ book.author_name }}</div>
                                <div class="rating">
                                    {% for i in range(book.rating|int) %}
                                    <span class="star">‚òÖ</span>
                                    {% endfor %}
                                    <span class="numeric-rating">
                                        {% if book.rating is not none %}
                                            {{ "%.1f"|format(book.rating) }}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- –ù–æ–≤–∏–Ω–∫–∏ -->
                <div class="book-shelf">
                    <h3>–ù–æ–≤–∏–Ω–∫–∏</h3>
                    <div class="shelf">
                        {% for book in new_books %}
                        <div class="book-item" onclick="window.location.href='{{ url_for('book_detail', isbn=book.isbn) }}'">
                            <img src="{{ book.cover_image_url }}" alt="{{ book.title }}">
                            <div class="book-info">
                                <div class="title">{{ book.title }}</div>
                                <div class="author">{{ book.author_name }}</div>
                                <div class="rating">
                                    {% for i in range(book.rating|int) %}
                                    <span class="star">‚òÖ</span>
                                    {% endfor %}
                                    <span class="numeric-rating">
                                        {% if book.rating is not none %}
                                            {{ "%.1f"|format(book.rating) }}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∫–Ω–∏–≥–∏ -->
                <div class="book-shelf">
                    <h3>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º</h3>
                    <div class="shelf">
                        {% for book in recommend_shelf %}
                        <div class="book-item" onclick="window.location.href='{{ url_for('book_detail', isbn=book.isbn) }}'">
                            <img src="{{ book.cover_image_url }}" alt="{{ book.title }}">
                            <div class="book-info">
                                <div class="title">{{ book.title }}</div>
                                <div class="author">{{ book.author_name }}</div>
                                <div class="rating">
                                    {% for i in range(book.rating|int) %}
                                    <span class="star">‚òÖ</span>
                                    {% endfor %}
                                    <span class="numeric-rating">
                                        {% if book.rating is not none %}
                                            {{ "%.1f"|format(book.rating) }}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª–∫–∏ -->
                {% if recommend_shelf|length == 50 %}
                    {% for shelf in additional_shelves %}
                    <div class="book-shelf">
                        <h3>–ï—â–µ –∫–Ω–∏–≥–∏</h3>
                        <div class="shelf">
                            {% for book in shelf %}
                            <div class="book-item" onclick="window.location.href='{{ url_for('book_detail', isbn=book.isbn) }}'">
                                <img src="{{ book.cover_image_url }}" alt="{{ book.title }}">
                                <div class="book-info">
                                    <div class="title">{{ book.title }}</div>
                                    <div class="author">{{ book.author_name }}</div>
                                    <div class="rating">
                                        {% for i in range(book.rating|int) %}
                                        <span class="star">‚òÖ</span>
                                        {% endfor %}
                                        <span class="numeric-rating">
                                            {% if book.rating is not none %}
                                                {{ "%.1f"|format(book.rating) }}
                                            {% else %}
                                                N/A
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                {% endif %}
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –ü—Ä–æ—Ñ–∏–ª—å -->
            <div id="profile" class="tab">
                <div class="profile-header">
                    <h3>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h3>
                    <button id="edit-btn" onclick="toggleEdit()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>

                <div class="profile-content">
                    <form id="profile-form" onsubmit="return false;">
                        <div class="avatar-section">
                            <input type="file" id="avatarInput" accept="image/*" hidden onchange="handleAvatarUpload(event)">
                            <img id="previewAvatar" src="{{ user.avatar_url | default('/static/default-avatar.png') }}" class="avatar" alt="–ê–≤–∞—Ç–∞—Ä" onclick="document.getElementById('avatarInput').click();">
                        </div>

                        <div class="form-group">
                            <label>–ù–∏–∫–Ω–µ–π–º:</label>
                            <input type="text" name="username" value="{{ user.username }}" readonly>
                        </div>

                        <div class="form-group">
                            <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</label>
                            <input type="date" name="birth_date"
                                   value="{{ user.birth_date }}"
                                   readonly>
                        </div>

                        <div class="form-group">
                            <label>–î–æ–ø—É—Å—Ç–∏–º—ã–π —Ä–µ–π—Ç–∏–Ω–≥:</label>
                            <div class="rating-badge" data-rating="{{ allowed_rating }}"></div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="save-btn" hidden>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            <button type="button" class="cancel-btn" hidden onclick="cancelEdit()">–û—Ç–º–µ–Ω–∞</button>
                            <button type="button" class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –ú–æ–∏ –∫–Ω–∏–≥–∏ -->
            <div id="myBooks" class="tab">
                <h3>–ú–æ–∏ –∫–Ω–∏–≥–∏</h3>
                <div class="book-shelf">
                    <h4>üìñ –ù–∞—á–∞—Ç—ã–µ –∫–Ω–∏–≥–∏</h4>
                    {% if reading_history_books %}
                        <div class="shelf">
                            {% for book in reading_history_books %}
                            <div class="book-item" onclick="window.location.href='{{ url_for('book_detail', isbn=book.isbn) }}'">
                                <img src="{{ book.cover_image_url }}" alt="{{ book.title }}">
                                <div class="book-info">
                                    <div class="title">{{ book.title }}</div>
                                    <div class="author">{{ book.author_name }}</div>
                                    <div class="rating">
                                        {% for i in range(book.rating|int) %}
                                        <span class="star">‚òÖ</span>
                                        {% endfor %}
                                        <span class="numeric-rating">
                                            {% if book.rating is not none %}
                                                {{ "%.1f"|format(book.rating) }}
                                            {% else %}
                                                N/A
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="empty-shelf">
                            <p>–í—ã –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª–∏ —á–∏—Ç–∞—Ç—å –Ω–∏ –æ–¥–Ω–æ–π –∫–Ω–∏–≥–∏</p>
                            <button onclick="showTab('home')">–ù–∞–π—Ç–∏ –∫–Ω–∏–≥–∏</button>
                        </div>
                    {% endif %}
                </div>
                <div class="book-shelf">
                    <h4>‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω—ã–µ</h4>
                    <div class="shelf">
                        {% for book in favorite_books %}
                        <div class="book-item" onclick="window.location.href='{{ url_for('book_detail', isbn=book.isbn) }}'">
                            <img src="{{ book.cover_image_url }}" alt="{{ book.title }}">
                            <div class="book-info">
                                <div class="title">{{ book.title }}</div>
                                <div class="author">{{ book.author_name }}</div>
                                <div class="rating">
                                    {% for i in range(book.rating|int) %}
                                    <span class="star">‚òÖ</span>
                                    {% endfor %}
                                    <span class="numeric-rating">
                                        {% if book.rating is not none %}
                                            {{ "%.1f"|format(book.rating) }}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </span>
                                    ‚ù§Ô∏è
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—å -->
            {% if session['user_role'] == 2 %}
            <div id="librarian" class="tab" style="display: none;">
                <div class="admin-header">
                    <h3>–ü–∞–Ω–µ–ª—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—è</h3>
                    <button id="add-book-btn" onclick="toggleAddBookForm()">–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</button>
                </div>
                <div id="add-book-form" style="display: none;">
                    <form id="book-form" onsubmit="submitBook(event)">
                        <div class="form-group">
                            <label for="title">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                            <input type="text" id="title" name="title" required>
                        </div>
                        <div class="form-group">
                            <label>–ê–≤—Ç–æ—Ä:</label>
                            <div class="author-fields">
                                <input type="text" id="author_last_name" name="author_last_name" placeholder="–§–∞–º–∏–ª–∏—è" required>
                                <input type="text" id="author_first_name" name="author_first_name" placeholder="–ò–º—è" required>
                                <input type="text" id="author_middle_name" name="author_middle_name" placeholder="–û—Ç—á–µ—Å—Ç–≤–æ">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="genre">–ñ–∞–Ω—Ä:</label>
                            <input type="text" id="genre" name="genre" required>
                        </div>
                        <div class="form-group">
                            <label for="publication_year">–ì–æ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:</label>
                            <input type="number" id="publication_year" name="publication_year"  required>
                        </div>
                        <div class="form-group">
                            <label for="publisher">–ò–∑–¥–∞—Ç–µ–ª—å:</label>
                            <input type="text" id="publisher" name="publisher" required>
                        </div>
                        <div class="form-group">
                            <label for="age_rating">–í–æ–∑—Ä–∞—Å—Ç–Ω–æ–π —Ä–µ–π—Ç–∏–Ω–≥:</label>
                            <input type="text" id="age_rating" name="age_rating" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 12+" required>
                        </div>
                        <div class="form-group">
                            <label for="total_pages">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü:</label>
                            <input type="number" id="total_pages" name="total_pages" min="1" required>
                        </div>
                        <div class="form-group">
                            <label for="isbn">ISBN:</label>
                            <input type="text" id="isbn" name="isbn" pattern="[0-9-]{10,17}" title="ISBN –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 10-17 —Ü–∏—Ñ—Ä –∏–ª–∏ –¥–µ—Ñ–∏—Å–æ–≤" required>
                        </div>
                        <div class="form-group">
                            <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                            <textarea id="description" name="description" rows="5"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="cover_image_url">URL –æ–±–ª–æ–∂–∫–∏:</label>
                            <input type="url" id="cover_image_url" name="cover_image_url" placeholder="https://example.com/cover.jpg">
                        </div>
                        <div class="form-group">
                            <label for="file_path">–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É:</label>
                            <input type="text" id="file_path" name="file_path" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, uploads/books/book.pdf" required>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="save-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            <button type="button" class="cancel-btn" onclick="toggleAddBookForm()">–û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </form>
                </div>
                <!-- –ù–µ–¥–∞–≤–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ -->
                <div class="book-shelf">
                    <h3>–ù–µ–¥–∞–≤–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ</h3>
                    <div class="shelf">
                        {% for book in new_books %}
                        <div class="book-item" onclick="window.location.href='{{ url_for('book_detail', isbn=book.isbn) }}'">
                            <img src="{{ book.cover_image_url }}" alt="{{ book.title }}">
                            <div class="book-info">
                                <div class="title">{{ book.title }}</div>
                                <div class="author">{{ book.author_name }}</div>
                                <div class="rating">
                                    {% for i in range(book.rating|int) %}
                                    <span class="star">‚òÖ</span>
                                    {% endfor %}
                                    <span class="numeric-rating">
                                        {% if book.rating is not none %}
                                            {{ "%.1f"|format(book.rating) }}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
            {% if session['user_role'] == 3 %}
            <div id="admin" class="tab" style="display: none;">
                <div class="admin-header">
                    <h3>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
                    <div class="filter-section">
                        <label for="periodFilter">–ü–µ—Ä–∏–æ–¥: </label>
                        <select id="periodFilter" onchange="updateStatistics()">
                            <option value="12">–ü–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥</option>
                            <option value="6">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 6 –º–µ—Å—è—Ü–µ–≤</option>
                            <option value="3">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–µ—Å—è—Ü–∞</option>
                        </select>
                    </div>
                </div>
                <div class="statistics-section">
                    <div class="chart-container">
                        <div class="chart-wrapper">
                            <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–º —á–∏—Ç–∞—Ç–µ–ª–µ–π</h4>
                            <canvas id="ageChart" width="400" height="200"></canvas>
                        </div>
                        <div class="chart-description" id="ageChartDescription">
                            <h5>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–∏–∞–≥—Ä–∞–º–º—ã</h5>
                            <p>–≠—Ç–∞ –¥–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–∏—Ç–∞—Ç–µ–ª–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–º –≥—Ä—É–ø–ø–∞–º. –û–Ω–∞ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å, –∫–∞–∫–∞—è –≤–æ–∑—Ä–∞—Å—Ç–Ω–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç–∏–≤–Ω–∞, –∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–∏–∂–Ω—ã–π —Ñ–æ–Ω–¥ –ø–æ–¥ –∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å—ã.</p>
                            <h5>–ü–æ–ª–µ–∑–Ω–æ—Å—Ç—å</h5>
                            <ul>
                                <li>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –¥–ª—è –∑–∞–∫—É–ø–∫–∏ –Ω–æ–≤—ã—Ö –∫–Ω–∏–≥.</li>
                                <li>–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π, –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ —Ä–∞–∑–Ω—ã–µ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –≥—Ä—É–ø–ø—ã.</li>
                                <li>–ê–Ω–∞–ª–∏–∑ –¥–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —Ç—Ä–µ–Ω–¥–æ–≤ —Å—Ä–µ–¥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</li>
                            </ul>
                            <button class="download-btn" onclick="openDownloadModal('ageChart', 'age_statistics')">–°–∫–∞—á–∞—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—É</button>
                        </div>
                    </div>
                </div>
                <div class="statistics-section">
                    <div class="chart-container">
                        <div class="chart-wrapper">
                            <h4>–°–∞–º—ã–µ —á–∏—Ç–∞–µ–º—ã–µ –∫–Ω–∏–≥–∏</h4>
                            <canvas id="popularBooksChart" width="400" height="200"></canvas>
                        </div>
                        <div class="chart-description" id="popularBooksChartDescription">
                            <h5>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–∏–∞–≥—Ä–∞–º–º—ã</h5>
                            <p>–î–∏–∞–≥—Ä–∞–º–º–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ç–æ–ø-5 —Å–∞–º—ã—Ö —á–∏—Ç–∞–µ–º—ã—Ö –∫–Ω–∏–≥ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏—Ö –ø—Ä–æ—á—Ç–µ–Ω–∏–π. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã—è–≤–∏—Ç—å –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ.</p>
                            <h5>–ü–æ–ª–µ–∑–Ω–æ—Å—Ç—å</h5>
                            <ul>
                                <li>–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –¥–ª—è —á–∏—Ç–∞—Ç–µ–ª–µ–π.</li>
                                <li>–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–∫—É–ø–æ–∫ –Ω–æ–≤—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–Ω–∏–≥.</li>
                                <li>–ê–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞.</li>
                            </ul>
                            <button class="download-btn" onclick="openDownloadModal('popularBooksChart', 'popular_books')">–°–∫–∞—á–∞—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—É</button>
                        </div>
                    </div>
                </div>
                <div class="statistics-section">
                <div class="chart-container">
                    <div class="chart-wrapper">
                        <h4>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –º–µ—Å—è—Ü–∞–º</h4>
                        <canvas id="activityChart" width="400" height="200"></canvas>
                    </div>
                    <div class="chart-description" id="activityChartDescription">
                        <h5>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–∏–∞–≥—Ä–∞–º–º—ã</h5>
                        <p>–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—á—Ç–µ–Ω–∏–π –∫–Ω–∏–≥ –ø–æ –º–µ—Å—è—Ü–∞–º –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥, –æ—Ç—Ä–∞–∂–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</p>
                        <h5>–ü–æ–ª–µ–∑–Ω–æ—Å—Ç—å</h5>
                        <ul>
                            <li>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∏–∫–æ–≤ –∏ —Å–ø–∞–¥–æ–≤ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤.</li>
                            <li>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –≤ –ø–µ—Ä–∏–æ–¥—ã –Ω–∏–∑–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.</li>
                            <li>–û—Ü–µ–Ω–∫–∞ –≤–ª–∏—è–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –Ω–∞ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å.</li>
                        </ul>
                        <button class="download-btn" onclick="openDownloadModal('activityChart', 'activity_statistics')">–°–∫–∞—á–∞—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—É</button>
                    </div>
                </div>
            </div>
            <div class="statistics-section">
                <div class="chart-container">
                    <div class="chart-wrapper">
                        <h4>–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å –∂–∞–Ω—Ä–æ–≤</h4>
                        <canvas id="genreChart" width="400" height="200"></canvas>
                    </div>
                    <div class="chart-description" id="genreChartDescription">
                        <h5>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–∏–∞–≥—Ä–∞–º–º—ã</h5>
                        <p>–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ—á—Ç–µ–Ω–∏–π –∫–Ω–∏–≥ –ø–æ –∂–∞–Ω—Ä–∞–º, –ø–æ–∫–∞–∑—ã–≤–∞—è, –∫–∞–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã.</p>
                        <h5>–ü–æ–ª–µ–∑–Ω–æ—Å—Ç—å</h5>
                        <ul>
                            <li>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–∫—É–ø–∫–∏ –∫–Ω–∏–≥ –≤ –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω—ã—Ö –∂–∞–Ω—Ä–∞—Ö.</li>
                            <li>–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –¥–ª—è —á–∏—Ç–∞—Ç–µ–ª–µ–π.</li>
                            <li>–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –º–µ–Ω–µ–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∂–∞–Ω—Ä–æ–≤ —á–µ—Ä–µ–∑ –∞–∫—Ü–∏–∏.</li>
                        </ul>
                        <button class="download-btn" onclick="openDownloadModal('genreChart', 'genre_statistics')">–°–∫–∞—á–∞—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—É</button>
                    </div>
                </div>
            </div>
            <div class="statistics-section">
                <div class="chart-container">
                    <div class="chart-wrapper">
                        <h4>–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ –º–µ—Å—è—Ü–∞–º</h4>
                        <canvas id="newUsersChart" width="400" height="200"></canvas>
                    </div>
                    <div class="chart-description" id="newUsersChartDescription">
                        <h5>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–∏–∞–≥—Ä–∞–º–º—ã</h5>
                        <p>–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–∞—á–∞–≤—à–∏—Ö —á–∏—Ç–∞—Ç—å –∫–Ω–∏–≥–∏, –ø–æ –º–µ—Å—è—Ü–∞–º –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥.</p>
                        <h5>–ü–æ–ª–µ–∑–Ω–æ—Å—Ç—å</h5>
                        <ul>
                            <li>–û—Ü–µ–Ω–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π.</li>
                            <li>–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ—Å—Ç–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫—É.</li>
                            <li>–ê–Ω–∞–ª–∏–∑ —Ñ–∞–∫—Ç–æ—Ä–æ–≤, –≤–ª–∏—è—é—â–∏—Ö –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é.</li>
                        </ul>
                        <button class="download-btn" onclick="openDownloadModal('newUsersChart', 'new_users_statistics')">–°–∫–∞—á–∞—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—É</button>
                    </div>
                </div>
            </div>
            </div>

            <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ä–º–∞—Ç–∞ -->
            <div id="downloadModal" class="modal">
                <div class="modal-content">
                    <span class="close-btn" onclick="closeDownloadModal()">&times;</span>
                    <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏—è</h3>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ, –≤ –∫–∞–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–∫–∞—á–∞—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—É –∏ –µ—ë –æ–ø–∏—Å–∞–Ω–∏–µ:</p>
                    <div class="format-options">
                        <button onclick="downloadSelectedChart('png')">–°–∫–∞—á–∞—Ç—å –∫–∞–∫ PNG</button>
                        <button onclick="downloadSelectedChart('pdf')">–°–∫–∞—á–∞—Ç—å –∫–∞–∫ PDF</button>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    <script src="/static/js/home_script.js"></script>
    <script src="/static/js/avatar.js"></script>

</body>
</html>